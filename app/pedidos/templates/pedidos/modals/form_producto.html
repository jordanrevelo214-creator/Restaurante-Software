<div class="modal-backdrop"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;"
    onclick="cerrarModal(event)">
    <div class="modal-content"
        style="background: white; padding: 25px; border-radius: 10px; width: 450px; max-width: 90%; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"
        onclick="event.stopPropagation()">

        <div
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
            <h2 style="margin: 0; font-size: 1.25rem; color: #333;">{{ titulo }}</h2>
            <button type="button" onclick="cerrarModal()"
                style="border: none; background: transparent; font-size: 1.5rem; cursor: pointer; color: #999;">&times;</button>
        </div>

        <form hx-post="{{ request.path }}" hx-target="#modal-container" hx-swap="innerHTML"
            enctype="multipart/form-data"
            onsubmit="btn=document.getElementById('btn-guardar'); btn.disabled=true; btn.innerText='Guardando...';">
            {% csrf_token %}

            {# RENDERIZADO DIN√ÅMICO DE CAMPOS (Para soportar Producto, Insumo, Movimiento, etc.) #}
            <div style="display: flex; flex-direction: column; gap: 15px;">
                {% for field in form %}
                <div>
                    <label
                        style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; color: #374151;">
                        {{ field.label }}
                    </label>
                    <div class="field-wrapper">
                        {{ field }}
                    </div>
                    {% if field.help_text %}
                    <small style="color: #6b7280; font-size: 0.8rem;">{{ field.help_text }}</small>
                    {% endif %}
                    {% if field.errors %}
                    <small style="color: #ef4444; font-size: 0.8rem;">{{ field.errors.0 }}</small>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            <div style="text-align: right; margin-top: 25px; border-top: 1px solid #eee; padding-top: 15px;">
                <button type="button" onclick="cerrarModal()"
                    style="padding: 10px 20px; background: #e5e7eb; border: none; border-radius: 5px; margin-right: 10px; cursor: pointer; color: #374151; font-weight: 600;">Cancelar</button>
                <button id="btn-guardar" type="submit"
                    style="padding: 10px 20px; background: #f97316; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; box-shadow: 0 2px 4px rgba(249, 115, 22, 0.3);">Guardar</button>
            </div>
        </form>
    </div>
</div>

<script>
    function cerrarModal() {
        document.getElementById('modal-container').innerHTML = '';
    }
</script>