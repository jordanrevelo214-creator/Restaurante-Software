{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Tomar Pedido - Mesa {{ mesa.numero }}</title>
    <link rel="stylesheet" href="{% static 'pedidos/css/detalle_mesa.css' %}">
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
</head>
<body>

    <div id="data-container" data-pedido-id="{{ pedido.id }}" data-csrf="{{ csrf_token }}" style="display: none;"></div>

    <div class="tablet-container">
        
        <div class="header">
            <h1>Tomar pedido mesa</h1>
        </div>

        <div class="main-body">
            <div class="left-panel">
                
                <div class="controls">
                    <div class="control-group">
                        <label>N√∫mero de la mesa</label>
                        <select disabled>
                            <option>Mesa {{ mesa.numero }}</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Estado de la mesa</label>
                        <select disabled>
                            <option>{{ mesa.get_estado_display }}</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Agregar items (comida)</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" placeholder="Buscar üîç">
                            <button style="padding: 10px; cursor: pointer;">Buscar</button>
                        </div>
                    </div>
                </div>

                <div class="product-list-container">
                    <div style="display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 10px; padding: 0 15px;">
                        <span>Item</span><span>Precio</span>
                    </div>

                    {% for producto in productos %}
                    <div class="product-item">
                        <div style="font-weight: bold;">{{ producto.nombre }}</div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span>${{ producto.precio }}</span>
                            <button class="btn-add" data-id="{{ producto.id }}" onclick="agregarProducto(this.getAttribute('data-id'))" style="width: auto;">Agregar</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="right-panel">
                <div class="ticket-header">
                    Item <span style="float: right;">Precio</span>
                </div>

                <ul class="ticket-items" id="order-items">
                    {% for item in pedido.items.all %}
                        <li>
                            <span>{{ item.producto.nombre }} <small>x{{ item.cantidad }}</small></span>
                            <span>${{ item.subtotal }}</span>
                        </li>
                    {% empty %}
                        <p style="text-align: center; color: #999;">Pedido vac√≠o</p>
                    {% endfor %}
                </ul>

                <div class="total-section">
                    <div class="total-row">
                        <span>Total</span>
                        <span>${{ pedido.total }}</span>
                    </div>

                    {% if pedido.estado == 'borrador' %}
                        {% if pedido.items.exists %}
                            <a href="{% url 'pedidos:confirmar_pedido' pedido.id %}" class="btn-confirmar">
                                < Confirmar Pedido
                            </a>
                        {% endif %}
                    {% elif pedido.estado in 'confirmado,listo,entregado' %}
                        <a href="{% url 'pedidos:pagar_pedido' pedido.id %}" class="btn-confirmar" style="background: #28a745; color: white; border: none;">
                            Cerrar Cuenta ($)
                        </a>
                    {% endif %}
                    
                    <a href="{% url 'usuarios:dashboard_mesero' %}" style="display: block; text-align: center; margin-top: 15px; color: #666; text-decoration: none;">Cancelar / Volver</a>
                </div>
            </div>

        </div>
    </div>

    <script src="{% static 'pedidos/js/detalle_mesa.js' %}"></script>
    <script>
        document.body.addEventListener('htmx:configRequest', (event) => {
            event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
        });
    </script>
</body>
</html>